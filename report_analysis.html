<!DOCTYPE html><!--ì´ì‹œì€ì œì‘-->
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒ„ì†Œì¤‘ë¦½ì§€í‚´ì´ - ë¶„ì„</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    .section { padding: 40px; text-align: center; }
    canvas { margin: 20px auto; width: 50vw !important; height: auto !important; display: block; }
    .chart-buttons { margin: 20px auto; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .chart-buttons button { padding: 10px 20px; border: none; background-color: #31624E; color: white; border-radius: 8px; cursor: pointer; }
    .chart-buttons button:hover { background-color: #1d3e33; }
    table { width: 90%; margin: 20px auto; border-collapse: collapse; font-size: 16px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #31624E; color: white; }
  </style>
  
</head>
<body>
  <header>
    <h1><a href="index.html" style="color: #31624E; text-decoration: none;">íƒ„ì†Œì¤‘ë¦½ì§€í‚´ì´</a></h1>
    <p style="margin: 0; font-size: 25px; color: #555;">í•¨ê»˜ ì§€ì¼œë‚˜ê°€ëŠ” ìš°ë¦¬ë“¤ì˜ ì§€êµ¬</p>
  </header>
  
  <nav>
    <ul class="menu">
      <li><a href="#">ì†Œê°œ</a>
        <ul class="submenu">
          <li><a href="purpose.html">ì„¤ë¦½ ëª©ì </a></li>
          <li><a href="howtouse.html">ì´ìš© ë°©ë²•</a></li>
          <li><a href="usage_status.html">ì´ìš© í˜„í™©</a></li>
        </ul>
      </li>
      <li><a href="#">ì •ì±…</a>
        <ul class="submenu">
          <li><a href="domestic_policy.html">êµ­ë‚´ ì •ì±…</a></li>
          <li><a href="international_policy.html">êµ­ì™¸ ì •ì±…</a></li>
        </ul>
      </li>
      <li><a href="#">íƒ„ì†Œê¸°ë¡</a>
        <ul class="submenu">
          <li><a href="record.html">íƒ„ì†Œ ê³„ì‚°ê¸°</a></li>
          <li><a href="report_analysis.html">ë¶„ì„</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <section class="section">
    <h2>ğŸ“‰ ë°°ì¶œëŸ‰ ì‹œê°í™”</h2>
    <div class="chart-buttons">
      <button onclick="drawCharts('all')">ì „ì²´ ë³´ê¸°</button>
      <button onclick="drawCharts('electricity')">ì „ê¸°</button>
      <button onclick="drawCharts('fuel')">ì—°ë£Œ</button>
      <button onclick="drawCharts('water')">ìˆ˜ë„</button>
      <button onclick="drawCharts('waste')">íê¸°ë¬¼</button>
      <button onclick="drawCharts('auto')">ìë™ì°¨</button>
    </div>
    <canvas id="carbonChart"></canvas>
  </section>
  <section class="section">
    <h3>ğŸ“‹ ë°°ì¶œ ë‚´ì—­ í‘œ</h3>
    <table id="logTable">
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ì „ê¸°</th>
          <th>ì—°ë£Œ</th>
          <th>ìˆ˜ë„</th>
          <th>íê¸°ë¬¼</th>
          <th>ìë™ì°¨</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  
  <section class="section">
    <h2>ğŸ’¡ ê°ì¶•ëŸ‰ ì‹œê°í™”</h2>
    <div class="chart-buttons">
      <button onclick="drawCharts('saved')">ì ˆì•½ëŸ‰ ë³´ê¸°</button>
    </div>
    <canvas id="savedChart"></canvas>
  </section>
  <section class="section">
    <h3>ğŸ“‹ ê°ì¶• ë‚´ì—­ í‘œ</h3>
    <table id="savedTable">
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ë„ë³´</th>
          <th>ìì „ê±°</th>
          <th>ëŒ€ì¤‘êµí†µ</th>
          <th>ì±„ì‹</th>
          <th>ëƒ‰ë°©</th>
          <th>ë‚œë°©</th>
          <th>ë¬¼ì ˆì•½</th>
          <th>ì¬ì‚¬ìš©</th>
          <th>ë¦¬í•„</th>
          <th>ì „ìë¬¸ì„œ</th>
          <th>ë¶„ë¦¬ë°°ì¶œ</th>
          <th>ì´ ì ˆê°ëŸ‰</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    let carbonChart;
    let savedChart;

    function drawCharts(type) {
      const carbonCtx = document.getElementById('carbonChart').getContext('2d');
      const savedCtx = document.getElementById('savedChart').getContext('2d');

      const carbonLogs = [], savedLogs = [];

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const data = JSON.parse(localStorage.getItem(key));
        if (key.startsWith('carbon_log_')) {
          carbonLogs.push(data);
        } else if (key.startsWith('carbon_saved_')) {
          savedLogs.push({ ...data, date: key.replace('carbon_saved_', '') });
        }
      }

      carbonLogs.sort((a, b) => new Date(a.date) - new Date(b.date));
      savedLogs.sort((a, b) => new Date(a.date) - new Date(b.date));

      const dates = carbonLogs.map(d => d.date);
      const electricity = carbonLogs.map(d => parseFloat(d.electricity?.replace(/[^\d.]/g, '')) || 0);
      const fuel = carbonLogs.map(d => parseFloat(d.fuel?.replace(/[^\d.]/g, '')) || 0);
      const water = carbonLogs.map(d => parseFloat(d.water?.replace(/[^\d.]/g, '')) || 0);
      const waste = carbonLogs.map(d => parseFloat(d.waste?.replace(/[^\d.]/g, '')) || 0);
      const auto = carbonLogs.map(d => parseFloat(d.auto?.replace(/[^\d.]/g, '')) || 0);

      const savedDates = savedLogs.map(d => d.date);
      const savedValues = savedLogs.map(d => d.total || d.amount || 0);

      if (carbonChart) carbonChart.destroy();
      if (savedChart) savedChart.destroy();

      if (type === 'saved') {
        savedChart = new Chart(savedCtx, {
          type: 'line',
          data: {
            labels: savedDates,
            datasets: [{ label: 'ì ˆì•½í•œ íƒ„ì†ŒëŸ‰ (kg COâ‚‚)', data: savedValues, borderColor: 'black', fill: false }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: 'top' } },
            scales: { y: { title: { display: true, text: 'kg COâ‚‚' } } }
          }
        });
        return;
      }

      const datasets = [];
      if (type === 'electricity' || type === 'all') datasets.push({ label: 'ì „ê¸°', data: electricity, borderColor: 'red', fill: false });
      if (type === 'fuel' || type === 'all') datasets.push({ label: 'ì—°ë£Œ', data: fuel, borderColor: 'blue', fill: false });
      if (type === 'water' || type === 'all') datasets.push({ label: 'ìˆ˜ë„', data: water, borderColor: 'green', fill: false });
      if (type === 'waste' || type === 'all') datasets.push({ label: 'íê¸°ë¬¼', data: waste, borderColor: 'purple', fill: false });
      if (type === 'auto' || type === 'all') datasets.push({ label: 'ìë™ì°¨', data: auto, borderColor: 'orange', fill: false });

      carbonChart = new Chart(carbonCtx, {
        type: 'line',
        data: { labels: dates, datasets },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: { y: { title: { display: true, text: 'kg COâ‚‚' } } }
        }
      });
    }

    function renderTable() {
      const tbody = document.querySelector('#logTable tbody');
      const savedTbody = document.querySelector('#savedTable tbody');
      tbody.innerHTML = '';
      savedTbody.innerHTML = '';

      const allKeys = Object.keys(localStorage).sort();
      for (const key of allKeys) {
        if (key.startsWith('carbon_log_')) {
          const data = JSON.parse(localStorage.getItem(key));
          const row = `<tr><td>${data.date}</td><td>${data.electricity}</td><td>${data.fuel}</td><td>${data.water}</td><td>${data.waste}</td><td>${data.auto}</td></tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        } else if (key.startsWith('carbon_saved_')) {
          const d = JSON.parse(localStorage.getItem(key));
          const row = `<tr><td>${key.replace('carbon_saved_', '')}</td>
<td>${(d.walk || 0).toFixed(2)}</td>
<td>${(d.bike || 0).toFixed(2)}</td>
<td>${(d.public || 0).toFixed(2)}</td>
<td>${(d.vegan || 0).toFixed(2)}</td>
<td>${(d.cooling || 0).toFixed(2)}</td>
<td>${(d.heating || 0).toFixed(2)}</td>
<td>${(d.water || 0).toFixed(2)}</td>
<td>${(d.reuse || 0).toFixed(2)}</td>
<td>${(d.refill || 0).toFixed(2)}</td>
<td>${(d.paperless || 0).toFixed(2)}</td>
<td>${(d.recycle || 0).toFixed(2)}</td>
<td>${(d.total || d.amount || 0).toFixed(2)}</td></tr>`;
          savedTbody.insertAdjacentHTML('beforeend', row);
        }
      }
    }

    window.onload = function () {
      drawCharts('all');
      renderTable();
    }
  </script>
</body>
</html>
