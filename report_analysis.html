<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒ„ì†Œì¤‘ë¦½ì§€í‚´ì´ - ë¶„ì„</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'GmarketSans', sans-serif;
      background-color: #ffffff;
    }
    header {
      background-color: #ffffff;
      color: #31624E;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em 20px;
    }
    nav {
      background-color: #E0EFE8;
    }
    nav ul.menu {
      list-style-type: none;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    nav ul li {
      position: relative;
      margin: 0 20px;
    }
    nav ul li a {
      display: block;
      color: black;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }
    nav ul li a:hover {
      background-color: #9DB0A9;
    }
    .submenu {
      display: none;
      position: absolute;
      top: 100%;
      background: white;
      border: 1px solid #ccc;
      list-style: none;
      padding: 0;
      width: 150px;
      z-index: 999;
    }
    nav ul li:hover .submenu {
      display: block;
    }
    .section {
      padding: 40px;
      text-align: center;
    }
    canvas {
      margin: 20px auto;
      max-width: 800px;
      display: block;
    }
    .chart-buttons {
      margin: 20px auto;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .chart-buttons button {
      padding: 10px 20px;
      border: none;
      background-color: #31624E;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .chart-buttons button:hover {
      background-color: #1d3e33;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      font-size: 16px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #31624E;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <h1><a href="index.html" style="color: #31624E; text-decoration: none;">íƒ„ì†Œì¤‘ë¦½ì§€í‚´ì´</a></h1>
             <p style="margin: 0; font-size: 25px; color: #555;">í•¨ê»˜ ì§€ì¼œë‚˜ê°€ëŠ” ìš°ë¦¬ë“¤ì˜ ì§€êµ¬</p>
  </header>
  <nav>
    <ul>
      <li><a href="#">ì†Œê°œ</a>
        <ul class="submenu">
          <li><a href="purpose.html">ì„¤ë¦½ ëª©ì </a></li>
          <li><a href="howtouse.html">ì´ìš© ë°©ë²•</a></li>
          <li><a href="usage_status.html">ì´ìš© í˜„í™©</a></li>
        </ul>
      </li>
      <li><a href="#">ì •ì±…</a>
        <ul class="submenu">
          <li><a href="domestic_policy.html">êµ­ë‚´ ì •ì±…</a></li>
          <li><a href="international_policy.html">êµ­ì™¸ ì •ì±…</a></li>
        </ul>
      </li>
      <li><a href="#">íƒ„ì†Œê¸°ë¡</a>
        <ul class="submenu">
          <li><a href="record.html">íƒ„ì†Œ ê³„ì‚°ê¸°</a></li>
          <li><a href="report_analysis.html">ë¶„ì„</a></li>
        </ul>
      </li>
    </ul>
  </nav>
  
  <!-- ë°°ì¶œëŸ‰ ë¶„ì„ -->
  <section class="section">
    <h2>ğŸ“‰ ë°°ì¶œëŸ‰ ì‹œê°í™”</h2>
    <div class="chart-buttons">
      <button onclick="drawCharts('all')">ì „ì²´ ë³´ê¸°</button>
      <button onclick="drawCharts('electricity')">ì „ê¸°</button>
      <button onclick="drawCharts('fuel')">ì—°ë£Œ</button>
      <button onclick="drawCharts('water')">ìˆ˜ë„</button>
      <button onclick="drawCharts('waste')">íê¸°ë¬¼</button>
      <button onclick="drawCharts('auto')">ìë™ì°¨</button>
    </div>
    <canvas id="carbonChart"></canvas>
  </section>
  <section class="section">
    <h3>ğŸ“‹ ë°°ì¶œ ë‚´ì—­ í‘œ</h3>
    <table id="logTable">
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ì „ê¸°</th>
          <th>ì—°ë£Œ</th>
          <th>ìˆ˜ë„</th>
          <th>íê¸°ë¬¼</th>
          <th>ìë™ì°¨</th>
          <th>ì ˆì•½</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ê°ì¶•ëŸ‰ ë¶„ì„ -->
  <section class="section">
    <h2>ğŸ’¡ ê°ì¶•ëŸ‰ ì‹œê°í™”</h2>
    <div class="chart-buttons">
      <button onclick="drawCharts('saved')">ì ˆì•½ëŸ‰ ë³´ê¸°</button>
    </div>
    <canvas id="savedChart"></canvas>
  </section>
  <section class="section">
    <h3>ğŸ“‹ ê°ì¶• ë‚´ì—­ í‘œ</h3>
    <table id="savedTable">
      <thead>
        <tr>
          <th>ë‚ ì§œ</th>
          <th>ì ˆì•½ëŸ‰</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    let carbonChart;
    let savedChart;

    function drawCharts(type) {
      const carbonCtx = document.getElementById('carbonChart').getContext('2d');
      const savedCtx = document.getElementById('savedChart').getContext('2d');

      const dates = [], electricity = [], fuel = [], water = [], waste = [], auto = [], saved = [];

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('carbon_log_')) {
          const data = JSON.parse(localStorage.getItem(key));
          const d = data.date;
          dates.push(d);
          electricity.push(parseFloat(data.electricity.replace(/[^\d.]/g, '')) || 0);
          fuel.push(parseFloat(data.fuel.replace(/[^\d.]/g, '')) || 0);
          water.push(parseFloat(data.water.replace(/[^\d.]/g, '')) || 0);
          waste.push(parseFloat(data.waste.replace(/[^\d.]/g, '')) || 0);
          auto.push(parseFloat(data.auto.replace(/[^\d.]/g, '')) || 0);
        } else if (key.startsWith('carbon_saved_')) {
          const savedData = JSON.parse(localStorage.getItem(key));
          saved.push({ date: savedData.date, amount: parseFloat(savedData.amount) });
        }
      }

      if (carbonChart) carbonChart.destroy();
      if (savedChart) savedChart.destroy();

      if (type === 'saved') {
        const savedDates = saved.map(x => x.date);
        const savedValues = saved.map(x => x.amount);
        savedChart = new Chart(savedCtx, {
          type: 'line',
          data: { labels: savedDates, datasets: [{ label: 'ì ˆì•½í•œ íƒ„ì†ŒëŸ‰', data: savedValues, borderColor: 'black', fill: false }] },
          options: { responsive: true, plugins: { legend: { position: 'top' } } }
        });
        return;
      }

      const datasets = [];
      if (type === 'electricity' || type === 'all') datasets.push({ label: 'ì „ê¸°', data: electricity, borderColor: 'red', fill: false });
      if (type === 'fuel' || type === 'all') datasets.push({ label: 'ì—°ë£Œ', data: fuel, borderColor: 'blue', fill: false });
      if (type === 'water' || type === 'all') datasets.push({ label: 'ìˆ˜ë„', data: water, borderColor: 'green', fill: false });
      if (type === 'waste' || type === 'all') datasets.push({ label: 'íê¸°ë¬¼', data: waste, borderColor: 'purple', fill: false });
      if (type === 'auto' || type === 'all') datasets.push({ label: 'ìë™ì°¨', data: auto, borderColor: 'orange', fill: false });

      carbonChart = new Chart(carbonCtx, {
        type: 'line',
        data: { labels: dates, datasets },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
    }

    function renderTable() {
      const tbody = document.querySelector('#logTable tbody');
      const savedTbody = document.querySelector('#savedTable tbody');
      tbody.innerHTML = '';
      savedTbody.innerHTML = '';

      const allKeys = Object.keys(localStorage).sort();
      for (const key of allKeys) {
        if (key.startsWith('carbon_log_')) {
          const data = JSON.parse(localStorage.getItem(key));
          const row = `<tr><td>${data.date}</td><td>${data.electricity}</td><td>${data.fuel}</td><td>${data.water}</td><td>${data.waste}</td><td>${data.auto}</td><td></td></tr>`;
          tbody.insertAdjacentHTML('beforeend', row);
        } else if (key.startsWith('carbon_saved_')) {
          const savedData = JSON.parse(localStorage.getItem(key));
          const savedRow = `<tr><td>${savedData.date}</td><td>${savedData.amount.toFixed(3)} kg COâ‚‚</td></tr>`;
          savedTbody.insertAdjacentHTML('beforeend', savedRow);
        }
      }
    }

    window.onload = function () {
      drawCharts('all');
      renderTable();
    }
  </script>
</body>
</html>
